<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>	
<comment>Generic query mapping for SQL databases</comment>
	<entry key="DB">GENERIC</entry>
	<entry key="MARKER">@@@</entry>
	<entry key="CREATE_SERVER_STATUS_TABLE">
			FLAVOUR SPECIFIC!!!
	</entry>
	<entry key="CREATE_SERVER_INFO_TABLE">
			FLAVOUR SPECIFIC!!!
	</entry>
	<entry key="CREATE_SERVER_LOG_TABLE">
			FLAVOUR SPECIFIC!!!
	</entry>
	<entry key="CREATE_SERVER_PROPERTIES_TABLE">
			FLAVOUR SPECIFIC!!!
	</entry>
	<entry key="INSERT_SERVER_STATUS">
			FLAVOUR SPECIFIC!!!
	</entry>
	<entry key="INSERT_DEFAULT_SERVER_PROPERTIES">
			INSERT INTO meandre_server_properties ( ID, value ) 
				VALUES ( 'HEARTBEAT_RATE', '5000' ), ('MAX_UPDATE_FAILURES', '5')
	</entry>
	<entry key="GET_SERVER_PROPERTIES">
			SELECT * 
			FROM meandre_server_properties
	</entry>
	<entry key="GET_SERVER_CLUSTER_LOG">
			SELECT * 
			FROM meandre_server_log
			ORDER BY ts DESC
	</entry>
	<entry key="GET_SERVER_CLUSTER_STATUS">
			SELECT * 
			FROM meandre_server_status
			ORDER BY status
	</entry>	
	<entry key="GET_SERVER_CLUSTER_INFOS">
			SELECT * 
			FROM meandre_server_info
			ORDER BY id
	</entry>
	<entry key="DROP_SERVER_STATUS_TABLE">
			DROP TABLE meandre_server_status
	</entry>
	<entry key="DROP_SERVER_INFO_TABLE">
			DROP TABLE meandre_server_info
	</entry>
	<entry key="DROP_SERVER_PROPERTIES_TABLE">
			DROP TABLE meandre_server_properties
	</entry>
	<entry key="DROP_SERVER_LOG_TABLE">
			DROP TABLE meandre_server_log
	</entry>
	<entry key="DELETE_SERVER_STATUS">
			DELETE FROM meandre_server_status  
				WHERE ID=? 
	</entry>
	<entry key="UPDATE_SERVER_STATUS">
			UPDATE meandre_server_status 
				SET status=?, 
				    previous_updated=updated, 
				    updated=?, 
				    uptime=uptime+updated-previous_updated
				WHERE ID=?
	</entry>
	<entry key="UPDATE_SERVER_STATUS_FAILURE">
			UPDATE meandre_server_status 
				SET status=?, 
				    previous_updated=updated, 
				    updated=?, 
				    uptime=uptime+updated-previous_updated,
				    failed_updates = failed_updates+1
				WHERE ID=?
	</entry>
	<entry key="INSERT_SERVER_INFO">
			INSERT INTO meandre_server_info (ID,ip,server_name,port,server_description,memory_available,number_processors,os_arch,os_name,os_version,java_version,java_vm_version,java_vm_vendor,local_user_name,user_home) 
				VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) 
	</entry>
	<entry key="DELETE_SERVER_INFO">
			DELETE FROM meandre_server_info 
				WHERE ID=? 
	</entry>
	<entry key="UPDATE_SERVER_INFO">
			UPDATE meandre_server_info 
				SET ip=?,
				    server_name=?,
				    port=?,
				    server_description=?,
				    memory_available=?,
				    number_processors=?,
				    os_arch=?,
				    os_name=?,
				    os_version=?,
				    java_version=?,
				    java_vm_version=?,
				    java_vm_vendor=?,
				    local_user_name=?,
				    user_home=?
				WHERE ID=?
	</entry>
	<entry key="DELETE_SERVER_STATUS">
			DELETE FROM meandre_server_status WHERE ID=?
	</entry>
	<entry key="DELETE_SERVER_INFO">
			DELETE FROM meandre_server_info WHERE ID=?
	</entry>
	<entry key="LOG_SERVER_EVENT">
			INSERT INTO meandre_server_log (
					ID,
					status,
					uptime,
					failed_updates,
					ip,
					server_name,
					port,
					server_description,
					memory_available,
					number_processors,
					os_arch, 
				 	os_name, 
				 	os_version, 
				 	java_version,
				 	java_vm_version,
				 	java_vm_vendor,
				 	local_user_name,
				 	user_home,
				 	ts
				)
				SELECT s.ID,
				       s.status,
				       s.uptime,
				       s.failed_updates,
				       i.ip,
				       i.server_name,
				       i.port,
				       i.server_description,
				       i.memory_available,
				       i.number_processors,
				       i.os_arch,i.os_name,
				       i.os_version,
				       i.java_version,
				       i.java_vm_version,
				       i.java_vm_vendor,
				       i.local_user_name,
				       i.user_home,
				       s.ts
			       FROM meandre_server_status AS s LEFT JOIN meandre_server_info AS i ON s.ID=i.ID
			       WHERE s.ID=?
	</entry>
	<entry key="MARK_OUTOFSYNC_SERVERS">
			UPDATE meandre_server_status 
				SET status="D",failed_updates=failed_updates+1
				WHERE CURRENT_TIMESTAMP()-ts>? and status!="D" 
	</entry>
	<entry key="SELECT_FAILED_UPDATE_COUNTS">
			SELECT failed_updates
				FROM meandre_server_status
				WHERE ID=?
	</entry>
	<entry key="LIST_DIRTY_NODES">
			SELECT i.ID,i.ip, i.port 
				FROM meandre_server_info AS i LEFT JOIN meandre_server_status AS s ON i.id=s.id 
				WHERE s.status="D"
	</entry>
</properties>