<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>	
<comment>Generic query mapping for SQL databases</comment>
	<entry key="DB">GENERIC</entry>
	<entry key="MARKER">@@@</entry>
	<entry key="CREATE_SERVER_STATUS_TABLE">
			CREATE TABLE IF NOT EXISTS meandre_server_status 
				(ID CHAR(16), 
				 status CHAR(1) default 'D', 
				 updated BIGINT default 0, 
				 previous_updated BIGINT default 0, 
				 uptime REAL default 0, 
				 free_memory REAL default 0, 
				 failed_updates INTEGER default 0,
				 ts timestamp,
				 INDEX USING HASH(status),
				 PRIMARY KEY(ID))
	</entry>
	<entry key="CREATE_SERVER_INFO_TABLE">
			CREATE TABLE IF NOT EXISTS meandre_server_info 
				(ID CHAR(16), 
				 ip CHAR(15) default '127.0.0.1', 
				 name CHAR(40) default 'localhost', 
				 port INTEGER default 1714, 
				 description CHAR(80) default 'unknown',
				 memory_available BIGINT,
				 number_processors INTEGER,
				 os_arch VARCHAR(40), 
				 os_name VARCHAR(40), 
				 os_version VARCHAR(40), 
				 java_version VARCHAR(20),
				 java_vm_version VARCHAR(20),
				 java_vm_vendor VARCHAR(40),
				 user_name VARCHAR(20),
				 user_home VARCHAR(255),
				 PRIMARY KEY(ID))
	</entry>
	<entry key="CREATE_SERVER_LOG_TABLE">
			CREATE TABLE IF NOT EXISTS meandre_server_log 
				(ID CHAR(16), 
				 status CHAR(1) default 'D', 
				 uptime REAL default 0, 
				 failed_updates INTEGER default 0,
				 ip CHAR(15) default '127.0.0.1', 
				 name CHAR(40) default 'localhost', 
				 port INTEGER default 1714, 
				 description CHAR(80) default 'unknown',
				 memory_available BIGINT,
				 number_processors INTEGER,
				 os_arch VARCHAR(40), 
				 os_name VARCHAR(40), 
				 os_version VARCHAR(40), 
				 java_version VARCHAR(20),
				 java_vm_version VARCHAR(20),
				 java_vm_vendor VARCHAR(40),
				 user_name VARCHAR(20),
				 user_home VARCHAR(255),
				 INDEX USING BTREE(ts),
				 ts TIMESTAMP)
	</entry>
	<entry key="CREATE_SERVER_PROPERTIES_TABLE">
			CREATE TABLE IF NOT EXISTS meandre_server_properties
				(ID CHAR(40),
				 value VARCHAR(128),
				 PRIMARY KEY (ID))
	</entry>
	<entry key="INSERT_DEFAULT_SERVER_PROPERTIES">
			INSERT INTO meandre_server_properties 
				VALUES ( "HEARTBEAT_RATE", 5000 ), ("MAX_UPDATE_FAILURES", 5)
	</entry>
	<entry key="GET_SERVER_PROPERTIES">
			SELECT * 
			FROM meandre_server_properties
	</entry>
	<entry key="DROP_SERVER_STATUS_TABLE">
			DROP TABLE meandre_server_status
	</entry>
	<entry key="DROP_SERVER_INFO_TABLE">
			DROP TABLE meandre_server_info
	</entry>
	<entry key="DROP_SERVER_PROPERTIES_TABLE">
			DROP TABLE meandre_server_properties
	</entry>
	<entry key="DROP_SERVER_LOG_TABLE">
			DROP TABLE meandre_server_log
	</entry>
	<entry key="INSERT_SERVER_STATUS">
			INSERT INTO meandre_server_status (ID,status,updated,free_memory) 
				VALUES (?,?,?,?) 
	</entry>
	<entry key="DELETE_SERVER_STATUS">
			DELETE FROM meandre_server_status  
				WHERE ID=? 
	</entry>
	<entry key="UPDATE_SERVER_STATUS">
			UPDATE meandre_server_status 
				SET status=?, 
				    previous_updated=updated, 
				    updated=?, 
				    uptime=uptime+updated-previous_updated
				WHERE ID=?
	</entry>
	<entry key="UPDATE_SERVER_STATUS_FAILURE">
			UPDATE meandre_server_status 
				SET status=?, 
				    previous_updated=updated, 
				    updated=?, 
				    uptime=uptime+updated-previous_updated,
				    failed_updates = failed_updates+1
				WHERE ID=?
	</entry>
	<entry key="INSERT_SERVER_INFO">
			INSERT INTO meandre_server_info (ID,ip,name,port,description,memory_available,number_processors,os_arch,os_name,os_version,java_version,java_vm_version,java_vm_vendor,user_name,user_home) 
				VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) 
	</entry>
	<entry key="DELETE_SERVER_INFO">
			DELETE FROM meandre_server_info 
				WHERE ID=? 
	</entry>
	<entry key="UPDATE_SERVER_INFO">
			UPDATE meandre_server_info 
				SET ip=?,
				    name=?,
				    port=?,
				    description=?,
				    memory_available=?,
				    number_processors=?,
				    os_arch=?,
				    os_name=?,
				    os_version=?,
				    java_version=?,
				    java_vm_version=?,
				    java_vm_vendor=?,
				    user_name=?,
				    user_home=?
				WHERE ID=?
	</entry>
	<entry key="DELETE_SERVER_STATUS">
			DELETE FROM meandre_server_status WHERE ID=?
	</entry>
	<entry key="DELETE_SERVER_INFO">
			DELETE FROM meandre_server_info WHERE ID=?
	</entry>
	<entry key="LOG_SERVER_EVENT">
			INSERT INTO meandre_server_log (
					ID,
					status,
					uptime,
					failed_updates,
					ip,
					name,
					port,
					description,
					memory_available,
					number_processors,
					os_arch, 
				 	os_name, 
				 	os_version, 
				 	java_version,
				 	java_vm_version,
				 	java_vm_vendor,
				 	user_name,
				 	user_home
				)
				SELECT s.ID,
				       s.status,
				       s.uptime,
				       s.failed_updates,
				       i.ip,
				       i.name,
				       i.port,
				       i.description,
				       i.memory_available,
				       i.number_processors,
				       i.os_arch,i.os_name,
				       i.os_version,
				       i.java_version,
				       i.java_vm_version,
				       i.java_vm_vendor,
				       i.user_name,
				       i.user_home 
			       FROM meandre_server_status AS s LEFT JOIN meandre_server_info AS i ON s.ID=i.ID
			       WHERE s.ID=?
	</entry>
	<entry key="MARK_OUTOFSYNC_SERVERS">
			UPDATE meandre_server_status 
				SET status="D",failed_updates=failed_updates+1
				WHERE CURRENT_TIMESTAMP()-ts>? and status!="D" 
	</entry>
	<entry key="SELECT_FAILED_UPDATE_COUNTS">
			SELECT failed_updates
				FROM meandre_server_status
				WHERE ID=?
	</entry>
	<entry key="DUMP_LOG_ENTRIES">
			SELECT * 
				FROM meandre_server_log
				ORDER ORDER BY ts DESC
	</entry>
	<entry key="LIST_DIRTY_NODES">
			SELECT i.ID,i.ip, i.port 
				FROM meandre_server_info AS i LEFT JOIN meandre_server_status AS s ON i.id=s.id 
				WHERE s.status="D"
	</entry>
</properties>